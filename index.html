<!DOCTYPE html>
<html lang="es">
<head>
  <title>GPS Transporte ‚Äî La Paz</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous"/>

  <style>
    :root{
      --bg:#f4f4f4;
      --fg:#222;
      --primary:#00423b;
      --accent:#15c9b7;
      --surface:#fff;
      --muted:#e8f6f4;
      --border:#d9d9d9;
      --radius:10px;
      --shadow:0 6px 18px rgba(0,0,0,.08);

      --icon-size:16px;   /* tama√±o botones*/
      --btn-h:42px;       /* altura de botones*/
      --btn-fz:14px;      /* tama√±o fuente en botones*/
      --map-height:520px;
      --max-width:1100px;
    }

    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:var(--bg); color:var(--fg);}

    /* HEADER: logo arriba y fila de botones en l√≠nea debajo (seg√∫n pedido) */
    header{ background:var(--primary); color:#fff; box-shadow:var(--shadow); position:sticky; top:0; z-index:1000;}
    .header-inner{ max-width:var(--max-width); margin:0 auto; padding:12px; display:flex; flex-direction:column; gap:10px; align-items:flex-start; }
    .brand{ display:flex; gap:12px; align-items:center; width:100%; }
    .brand .logo{ width:56px; height:56px; border-radius:10px; background:#031a17; display:grid; place-items:center; font-weight:700; color:#fff; font-size:18px;}
    .brand h1{ margin:0; font-size:18px; }

    /* fila de navegaci√≥n (alineada L‚ÜíR) */
    .nav-row{ display:flex; gap:8px; align-items:center; width:100%; flex-wrap:wrap; }
    .nav-btn{ height:var(--btn-h); padding:0 12px; display:inline-flex; gap:8px; align-items:center; border-radius:8px; background:rgba(255,255,255,0.95); color:var(--primary); border:1px solid rgba(255,255,255,0.08); cursor:pointer; font-size:var(--btn-fz); box-shadow:none; }
    .nav-btn.primary{ background:var(--accent); color:#fff; border:1px solid var(--accent); }
    .nav-btn .fa { font-size:var(--icon-size); line-height:1; color:var(--primary); }
    .nav-btn.primary .fa { color: #fff; }

    /* dropdown simple */
    .menu-item{ position:relative; }
    .dropdown{ position:absolute; top:calc(100% + 8px); left:0; background:var(--surface); border:1px solid var(--border); border-radius:8px; min-width:220px; display:none; z-index:30; box-shadow:var(--shadow); }
    .menu-item:hover .dropdown{ display:block; }
    .dropdown a{ display:block; padding:10px 12px; color:var(--fg); text-decoration:none; }

    /* main layout */
    main{ max-width:var(--max-width); margin:16px auto; padding:0 12px; }
    .grid{ display:grid; gap:12px; grid-template-columns: 1fr; }
    @media(min-width: 880px){ .grid{ grid-template-columns: 360px 1fr; } }

    .panel{ background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow); }
    .map-box{ height:var(--map-height); border-radius:8px; overflow:hidden; border:1px solid var(--border); }

    .input-row{ display:flex; gap:10px; align-items:center; width:100%; }
    .input-row label{ min-width:86px; }
    .input-row input[type="text"]{ flex:1; height:40px; padding:0 12px; border-radius:8px; border:1px solid var(--border); font-size:15px; }

    /* fila de botones del panel destino (alineados en l√≠nea) */
    .button-row{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .btn-lg{ height:44px; padding:0 14px; border-radius:8px; background:var(--primary); color:#fff; border:none; font-size:15px; cursor:pointer; display:inline-flex; gap:8px; align-items:center;}
    .btn-outline{ background:#fff; color:var(--primary); border:1px solid rgba(0,0,0,0.06); }

    .results{ margin-top:10px; background:var(--muted); padding:10px; border-radius:8px; border:1px solid #b2dfdb; font-size:14px; }

    /* lista de lugares r√°pidos */
    .list-item{ display:flex; gap:10px; align-items:center; padding:8px; border-radius:8px; cursor:pointer; }
    .list-item .fa{ width:24px; text-align:center; color:var(--primary); }

    /* modal gen√©rico */
    .modal-backdrop{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.45); z-index:1001; }
    .modal{ width:min(520px,92vw); background:#fff; border-radius:10px; overflow:hidden; box-shadow:var(--shadow); }
    .modal .modal-body{ padding:16px; }
    .modal .modal-footer{ padding:12px; display:flex; justify-content:flex-end; gap:8px; border-top:1px solid #eee; }

    /* footer */
    footer{ margin-top:18px; padding:12px 0; background:transparent; color:var(--fg); }
    .footer-inner{ max-width:var(--max-width); margin:0 auto; padding:0 12px; display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; align-items:center; }
    .socials{ display:flex; gap:16px; align-items:center; }
    .social-link{ 
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      background: #fff;
      border-radius: 6px;
      text-decoration: none;
      border: 1px solid rgba(0,0,0,0.06);
      transition: transform 0.2s;
    }
    .social-link:hover {
      transform: scale(1.1);
    }
    .social-link img {
      width: 16px;
      height: 16px;
      object-fit: contain;
    }

    /* dark mode */
    .dark-mode{ --bg:#121212; --fg:#e6e6e6; --surface:#1b1b1b; --muted:#242424; --border:#2b2b2b; --primary:#0aa089; }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <!-- Brand (logo + t√≠tulo) -->
      <div class="brand">
        <div class="logo" aria-hidden="true">LP</div>
        <div>
          <h1 id="appTitle">GPS Transporte ‚Äî La Paz</h1>
          <div style="font-size:12px; opacity:.9">Centro de transporte comunitario</div>
        </div>
      </div>

      <!-- Nav en l√≠nea (orden: Rutas ¬∑ Gu√≠a ¬∑ Modo ¬∑ English ¬∑ Admin ¬∑ Iniciar sesi√≥n) -->
      <nav class="nav-row" aria-label="Navegaci√≥n principal">
        <div class="menu-item">
          <button class="nav-btn" id="btnRoutes"><i class="fa fa-location-dot"></i><span class="label">Rutas</span></button>
          <div class="dropdown" aria-label="submenu rutas">
            <a href="rutas/linea-1.html">L√≠nea 1 ‚Äî Villa F√°tima ‚áÑ Miraflores</a>
            <a href="rutas/linea-2.html">L√≠nea 2 ‚Äî Ceja ‚áÑ Cementerio</a>
            <a href="rutas/linea-3.html">L√≠nea 3 ‚Äî Terminal ‚áÑ Telef√©rico Central</a>
            <a href="ver_rutas.html"><strong>Ver todas las rutas ‚Üí</strong></a>
          </div>
        </div>

        <button class="nav-btn" id="btnGuide"><i class="fa fa-book"></i><span class="label">Gu√≠a</span></button>
        <button class="nav-btn" id="btnDark"><i class="fa fa-moon"></i><span class="label">Modo</span></button>
        <button class="nav-btn" id="btnLang"><i class="fa fa-language"></i><span class="label">English</span></button>

        <div class="menu-item">
          <button class="nav-btn" id="btnAdmin"><i class="fa fa-wrench"></i><span class="label">Admin</span></button>
          <div class="dropdown" aria-label="submenu admin">
            <a href="agregar_linea.html">‚ûï Agregar l√≠nea</a>
            <a href="base_datos.html">üìÑ Ver base de datos</a>
            <a href="sindicatos.html">ü§ù Sindicatos</a>
          </div>
        </div>

        <!--Iniciar sesi√≥n-->
        <button class="nav-btn primary" id="btnLogin"><i class="fa fa-user-lock"></i><span class="label">Iniciar sesi√≥n</span></button>
      </nav>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="panel">
        <h2>Destino</h2>

        <div class="input-row" style="margin-top:8px;">
          <label for="dest">Destino:</label>
          <input id="dest" type="text" placeholder="Ej: Plaza Murillo" />
        </div>

        <!-- Botones en l√≠nea seg√∫n pedido -->
        <div class="button-row" style="margin-top:10px;">
          <button class="nav-btn btn-outline" id="btnMyLoc"><i class="fa fa-location-crosshairs"></i> Mi ubicaci√≥n</button>
          <button class="btn-lg" id="btnMarkDest"><i class="fa fa-map-pin"></i> Marcar destino</button>
          <button class="nav-btn btn-outline" id="btnFindRoutes"><i class="fa fa-route"></i> Rutas</button>
        </div>

        <div id="results" class="results">Escribe un destino y usa los botones para marcar.</div>

        <hr aria-hidden="true" style="margin:12px 0; border:none; height:1px; background:#eee;" />

        <div>
          <h3 style="margin:6px 0 8px 0">Lugares r√°pidos</h3>
          <!-- lugares solicitados -->
          <div class="list-item" onclick="quickPlace('plaza estudiante')"><i class="fa fa-square-check"></i><span>Plaza Estudiante</span></div>
          <div class="list-item" onclick="quickPlace('plaza murillo')"><i class="fa fa-square-check"></i><span>Plaza Murillo</span></div>
          <div class="list-item" onclick="quickPlace('miraflores')"><i class="fa fa-square-check"></i><span>Miraflores</span></div>
          <div class="list-item" onclick="quickPlace('prado')"><i class="fa fa-square-check"></i><span>Prado</span></div>
          <div class="list-item" onclick="quickPlace('terminal')"><i class="fa fa-square-check"></i><span>Terminal</span></div>
          <div class="list-item" onclick="quickPlace('umsa')"><i class="fa fa-square-check"></i><span>UMSA</span></div>
          <div class="list-item" onclick="quickPlace('cementerio')"><i class="fa fa-square-check"></i><span>Cementerio</span></div>
          <div class="list-item" onclick="quickPlace('teleferico central')"><i class="fa fa-square-check"></i><span>Telef√©rico Central</span></div>
          <div class="list-item" onclick="quickPlace('ceja')"><i class="fa fa-square-check"></i><span>Ceja</span></div>
          <div class="list-item" onclick="quickPlace('achachical')"><i class="fa fa-square-check"></i><span>Achachicala</span></div>
          <div class="list-item" onclick="quickPlace('villa victoria')"><i class="fa fa-square-check"></i><span>Villa Victoria</span></div>
        </div>
      </section>

      <section class="panel">
        <div id="map" class="map-box" role="application" aria-label="Mapa"></div>
      </section>
    </div>
  </main>
<!-- imagenes y logos -->
  <!-- Modal de inicio de sesi√≥n -->
  <div class="modal-backdrop" id="loginModal">
    <div class="modal">
      <div class="modal-body">
        <h3 style="margin:0 0 16px">Iniciar sesi√≥n</h3>
        
        <div style="margin-bottom:12px">
          <label for="email">Correo electr√≥nico</label>
          <input type="email" id="email" style="width:100%; margin-top:4px" placeholder="ejemplo@dominio.com" required>
        </div>
        
        <div style="margin-bottom:12px">
          <label for="password">Contrase√±a</label>
          <input type="password" id="password" style="width:100%; margin-top:4px" placeholder="Contrase√±a" required>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="nav-btn" onclick="closeLoginModal()">Cancelar</button>
        <button class="nav-btn primary" onclick="login()">Ingresar</button>
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-inner">
      <div>Contacto: lapazbus@lapaz.bo ‚Äî Tel: 2652444 / +591 76522444</div>
      <div class="socials" aria-label="Redes sociales">
        <a href="#" title="Facebook" class="social-link">
          <img src="img/fac.png" alt="Facebook" width="15" height="15">
        </a>
        <a href="#" title="X / Twitter" class="social-link">
          <img src="img/X.png" alt="X / Twitter" width="10" height="10">
        </a>
        <a href="#" title="whatsapp" class="social-link">
          <img src="img/was.jpeg" alt="whatsapp" width="10" height="10">
        </a>
        <a href="#" title="Telegram" class="social-link">
          <img src="img/tel.jpg" alt="Telegram" width="15" height="15">
        </a>
      </div>
    </div>
  </footer>

  <!-- Modales: Gu√≠a y Login -->
  <div id="guideModal" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="guideTitle">
      <div class="modal-body">
        <h3 id="guideTitle">Gu√≠a r√°pida</h3>
        <p>Esta gu√≠a explica c√≥mo usar el mapa, marcar destinos y buscar rutas.</p>
        <ul>
          <li>Usa "Mi ubicaci√≥n" para centrar el mapa en tu posici√≥n (si el navegador lo permite).</li>
          <li>Usa "Marcar destino" para colocar un pin en el mapa.</li>
          <li>Usa "Rutas" para consultar rutas entre dos puntos (requiere backend o JSON local).</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button class="nav-btn btn-outline" id="closeGuide">Cerrar</button>
      </div>
    </div>
  </div>

  <div id="loginModal" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="loginTitle">
      <div class="modal-body">
        <h3 id="loginTitle">Iniciar sesi√≥n</h3>

  <!-- cuadro de login -->
        <form id="loginForm" onsubmit="return false;">
          <div style="display:flex;flex-direction:column;gap:8px;">
            <label for="email">Correo</label>
            <input id="email" type="email" placeholder="un_correo_de@ejemplo.com" style="padding:8px;border:1px solid #ddd;border-radius:6px;" required />
            <label for="pass">Contrase√±a</label>
            <input id="pass" type="password" placeholder="Contrase√±a" style="padding:8px;border:1px solid #ddd;border-radius:6px;" required />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="nav-btn btn-outline" id="closeLogin">Cerrar</button>
        <button class="nav-btn primary" id="doLogin">Ingresar</button>
      </div>
    </div>
  </div>

  <!-- Leaflet (JS) -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    /* Inicializa el mapa centrado en La Paz y aplica l√≠mites aproximados */
    const map = L.map('map', { zoomControl:true }).setView([-16.5, -68.15], 13);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18, attribution: '¬© OpenStreetMap' }).addTo(map);

    // L√≠mites aproximados de la ciudad de La Paz para evitar drag fuera de zona
    const lpBounds = L.latLngBounds([-16.62, -68.24], [-16.43, -68.02]);
    map.setMaxBounds(lpBounds);
    map.on('drag', () => map.panInsideBounds(lpBounds, { animate:false }));

    // Marcador de usuario (inicial) y marcador de destino (a crear)
    let userMarker = L.marker([-16.5, -68.15]).addTo(map).bindPopup("Tu ubicaci√≥n");
    let destMarker = null;
    let lastClicked = null;
    map.on('click', e => lastClicked = e.latlng); // guarda √∫ltima posici√≥n click mapa

    // Selectores r√°pidos
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    const results = $('#results');

    /* Tabla mejorada de lugares comunes con coordenadas exactas */
      const commonPlaces = {
      "plaza estudiante": [-16.5041, -68.1311],     // Plaza del Estudiante / Franz Tamayo
      "plaza murillo": [-16.4958, -68.1336],        // Centro de la plaza
      "miraflores": [-16.4989, -68.1219],          // Plaza Triangular (zona central de Miraflores)
      "prado": [-16.5050, -68.1345],                // El Obelisco, punto central del Paseo del Prado
      "terminal": [-16.4887, -68.1418],             // Terminal de Buses de La Paz
      "umsa": [-16.5042, -68.1331],                 // Monoblock Central UMSA, Avenida Villaz√≥n
      "cementerio": [-16.4969, -68.1517],           // Cementerio General de La Paz
      "teleferico central": [-16.4897, -68.1335],    // Estaci√≥n Central Telef√©rico (L√≠nea Roja)
      "ceja": [-16.5029, -68.1751],                 // Punto central en La Ceja de El Alto
      "achachicala": [-16.4839, -68.1350],          // Cruce Achachicala (referencia de la zona)
      "villa victoria": [-16.5248, -68.1639]        // Referencia aproximada de la zona (basado en GR5W+PJG)
    };
    /**
     * Marca el destino por nombre conocido o por el √∫ltimo click en el mapa.
     * name: texto ingresado por el usuario (puede coincidir con commonPlaces)
     */
    function markDestinationByName(name){
      let coords = null;
      if(name){
        const key = name.trim().toLowerCase();
        if(commonPlaces[key]) coords = commonPlaces[key];
      }
      // si no hay coords y el usuario hizo click, usa el √∫ltimo click
      if(!coords && lastClicked) coords = [lastClicked.lat, lastClicked.lng];
      // fallback central
      if(!coords) coords = [-16.5, -68.15];

      // remueve marcador anterior y coloca uno nuevo
      if(destMarker) map.removeLayer(destMarker);
      destMarker = L.marker(coords).addTo(map).bindPopup("Destino: " + (name || "Sin nombre")).openPopup();
      map.setView(coords, 14);
      results.textContent = `Destino marcado (${coords[0].toFixed(5)}, ${coords[1].toFixed(5)})`;
    }

    /* Evento para el bot√≥n "Marcar destino" */
    $('#btnMarkDest').addEventListener('click', ()=> markDestinationByName($('#dest').value));

    /**
     * Obtiene la ubicaci√≥n del navegador y la marca en el mapa.
     * Muestra mensajes de error si no est√° disponible o fuera de l√≠mites.
     */
    $('#btnMyLoc').addEventListener('click', ()=>{
      if(!navigator.geolocation){ results.textContent = 'Geolocalizaci√≥n no disponible.'; return; }
      navigator.geolocation.getCurrentPosition(pos=>{
        const { latitude, longitude } = pos.coords;
        const latlng = L.latLng(latitude, longitude);
        if(!lpBounds.contains(latlng)){ results.textContent = 'Tu ubicaci√≥n est√° fuera de La Paz.'; return; }
        if(userMarker) map.removeLayer(userMarker);
        userMarker = L.marker(latlng).addTo(map).bindPopup("Tu ubicaci√≥n").openPopup();
        map.setView(latlng, 14);
        results.textContent = `Ubicaci√≥n establecida (${latitude.toFixed(5)}, ${longitude.toFixed(5)})`;
      }, err=>{
        results.textContent = 'No se pudo obtener la ubicaci√≥n.';
      }, { enableHighAccuracy:true, timeout:8000});
    });

    /**
     * Simula b√∫squeda de rutas entre marcador de usuario y destino.
     * Actualmente devuelve texto; integrar backend o JSON si est√° disponible.
     */
    $('#btnFindRoutes').addEventListener('click', ()=>{
      const u = userMarker ? userMarker.getLatLng() : null;
      const d = destMarker ? destMarker.getLatLng() : null;
      if(!u || !d){ results.textContent = 'Marca tu ubicaci√≥n y un destino para buscar rutas.'; return; }
      results.innerHTML = `<strong>Rutas</strong><br>Desde: ${u.lat.toFixed(5)}, ${u.lng.toFixed(5)}<br>Hasta: ${d.lat.toFixed(5)}, ${d.lng.toFixed(5)}<br><em>Conectando al backend...</em>`;
  // Pendiente: fetch('/api/routes?from=...&to=...') -> renderizar rutas
    });

    /**
     * Llena el campo destino con un lugar r√°pido y lo marca en el mapa.
     */
    function quickPlace(key){ $('#dest').value = key; markDestinationByName(key); }

    /**
     * Alterna modo oscuro (aplica la clase .dark-mode al body)
     */
    $('#btnDark').addEventListener('click', ()=> document.body.classList.toggle('dark-mode'));

    /* ---------------- Modales (Gu√≠a y Login) ---------------- */

    // Abre y cierra modal gu√≠a
    $('#btnGuide').addEventListener('click', ()=> openModal('#guideModal'));
    $('#closeGuide').addEventListener('click', ()=> closeModal('#guideModal'));

    // Abre y cierra modal login
    $('#btnLogin').addEventListener('click', ()=> openModal('#loginModal'));
    $('#closeLogin').addEventListener('click', ()=> closeModal('#loginModal'));

    /**
     * Abre un modal identificado por selector (mostrar backdrop)
     * selector: '#loginModal' o '#guideModal'
     */
    function openModal(selector){
      const el = document.querySelector(selector);
      if(!el) return;
      el.style.display = 'flex';
      el.setAttribute('aria-hidden','false');
    }

    /**
     * Cierra modal identificado por selector
     */
    function closeModal(selector){
      const el = document.querySelector(selector);
      if(!el) return;
      el.style.display = 'none';
      el.setAttribute('aria-hidden','true');
    }

    /* Manejo del formulario de login: no redirecciona, muestra "Implementado" al enviar */
    $('#doLogin').addEventListener('click', ()=>{
      const email = $('#email').value.trim();
      const pass = $('#pass').value;
      // validaci√≥n m√≠nima
      if(!email || !pass){ alert('Ingrese correo y contrase√±a'); return; }
      // Simula autenticaci√≥n: aqu√≠ ir√≠a fetch a API si est√° disponible
      closeModal('#loginModal');

      // Muestra mensaje "Implementado" cerca del √°rea de resultados (petici√≥n del usuario)
      showTemporaryBadge('Implementado', 3000);
    });

    /**
     * Muestra una peque√±a notificaci√≥n temporal con texto dado.
     * texto: string a mostrar
     * ms: duraci√≥n en ms
     */
    function showTemporaryBadge(text, ms){
      // crear badge
      const b = document.createElement('div');
      b.textContent = text;
      b.style.position = 'fixed';
      b.style.right = '18px';
      b.style.top = '78px';
      b.style.background = 'var(--accent)';
      b.style.color = '#fff';
      b.style.padding = '8px 12px';
      b.style.borderRadius = '8px';
      b.style.boxShadow = '0 6px 18px rgba(0,0,0,.12)';
      b.style.zIndex = 2000;
      document.body.appendChild(b);
      setTimeout(()=> b.style.opacity = '0.0', ms - 300);
      setTimeout(()=> b.remove(), ms);
    }

    /* ---------------- Idioma (bot√≥n English) ---------------- */
    let currentLang = 'es';
    $('#btnLang').addEventListener('click', ()=>{
      currentLang = currentLang === 'es' ? 'en' : 'es';
      const labels = {
        es: { routes:'Rutas', guide:'Gu√≠a', login:'Iniciar sesi√≥n', myloc:'Mi ubicaci√≥n', mark:'Marcar destino', title:'GPS Transporte ‚Äî La Paz' },
        en: { routes:'Routes', guide:'Guide', login:'Sign in', myloc:'My location', mark:'Mark destination', title:'GPS Transport ‚Äî La Paz' }
      };
      $('#btnRoutes .label').textContent = labels[currentLang].routes;
      $('#btnGuide .label').textContent = labels[currentLang].guide;
      $('#btnLogin .label').textContent = labels[currentLang].login;
      $('#btnMyLoc').innerHTML = `<i class="fa fa-location-crosshairs"></i> ${labels[currentLang].myloc}`;
      $('#btnMarkDest').innerHTML = `<i class="fa fa-map-pin"></i> ${labels[currentLang].mark}`;
      $('#appTitle').textContent = labels[currentLang].title;
      // cambiar texto de placeholder
      $('#dest').placeholder = currentLang === 'es' ? 'Ej: Plaza Murillo' : 'Ex: Plaza Murillo';
    });

    (function adjustIcons(){
      $$('.nav-btn .fa').forEach(i=> i.style.width = '18px');
    })();
  </script>
</body>
</html>