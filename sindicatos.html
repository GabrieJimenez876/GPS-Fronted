
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Sindicatos ‚Äî GPS Transporte La Paz</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous"/>
  
  <style>
    :root{ --c-primary:#004d40; --c-bg:#f6f7f8; --c-fg:#1f2937; --c-panel:#ffffff; --c-border:#e5e7eb; --radius:12px; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--c-bg);color:var(--c-fg)}
    header{position:sticky;top:0;z-index:20;background:var(--c-primary);color:#fff}
    .header-inner{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:12px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:36px;height:36px;border-radius:50%;background:#00a58c;display:grid;place-items:center;font-weight:700}
    .brand h1{font-size:18px;margin:0}
    nav{flex:1;display:flex;justify-content:center}
    .menu{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{height:42px;padding:0 14px;border:1px solid #9ee7db;border-radius:8px;background:#e6fffa;color:#083b35;cursor:pointer}
    .btn.primary{background:#00a58c;color:#fff;border-color:#00a58c}
    .menu-item{position:relative}
    .dropdown{position:absolute;top:calc(100% + 6px);left:0;min-width:240px;background:#fff;border:1px solid var(--c-border);border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.08);display:none;padding:6px;z-index:30}
    .dropdown a{display:block;padding:10px 12px;border-radius:8px;color:#111;text-decoration:none}
    .dropdown a:hover{background:#f3f4f6}
    .menu-item:hover .dropdown{display:block}
    .profile-area{display:flex;align-items:center;gap:10px}
    .container{max-width:1200px;margin:0 auto;padding:14px;display:grid;gap:14px}
    .panel{background:var(--c-panel);border:1px solid var(--c-border);border-radius:var(--radius);box-shadow:0 6px 18px rgba(0,0,0,.06)}
    .panel header{padding:12px 14px;border-bottom:1px solid var(--c-border)}
    .panel .content{padding:12px 14px}
    footer{background:var(--c-primary);color:#fff;margin-top:14px}
    .footer-inner{max-width:1200px;margin:0 auto;padding:14px;display:grid;gap:10px}
    .socials{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .socials a{display:inline-flex;align-items:center;gap:6px;background:#00695c;color:#fff;text-decoration:none;padding:4px 8px;border-radius:8px}
    .socials svg{width:16px;height:16px;fill:#fff}
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:50}
    .modal{width:min(520px,92vw);background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    .modal header{background:#00a58c;color:#fff;padding:12px 16px}
    .modal .content{padding:16px;display:grid;gap:10px}
    .modal .footer{padding:12px 16px;display:flex;justify-content:flex-end;gap:10px;border-top:1px solid #eee}
    input[type="text"],input[type="email"],input[type="password"]{height:42px;padding:0 12px;border:1px solid var(--c-border);border-radius:8px}
    .dark body{background:#121212;color:#e6e6e6}
  </style>

  <style>
    /* Ensure header/menu and dropdowns render above maps */
    .header-inner, .menu, .menu .btn, .profile-area, .dropdown { position: relative; z-index: 1100; }
    .dropdown { z-index: 1110; }
    #map, .map-box { position: relative; z-index: 0; }
    .backdrop, .modal-backdrop { z-index: 1200; }

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .card{background:var(--c-panel);border:1px solid var(--c-border);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,.06);cursor:pointer}
    .card:hover{transform:translateY(-1px)}
    .card h3{margin:0 0 6px 0}
    .card p{margin:0;color:#374151}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border:1px solid #ddd;padding:8px;font-size:14px}
    .table th{background:var(--c-primary);color:#fff;text-align:left}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }
  </style>
  <style>
    /* nav compatibility */
    .nav-row { display:flex; gap:8px; align-items:center; width:100%; }
    .nav-left { display:flex; gap:8px; align-items:center; }
    .nav-right { margin-left:auto; display:flex; gap:8px; }
    .nav-btn{ height:42px; padding:0 12px; display:inline-flex; gap:8px; align-items:center; border-radius:8px; background:rgba(255,255,255,0.95); color:var(--c-primary); border:1px solid rgba(255,255,255,0.08); cursor:pointer; font-size:14px; }
    .nav-btn.primary{ background:var(--c-primary); color:#fff; border-color:var(--c-primary); }
    .nav-btn .fa{ font-size:16px; }
  </style>

  <!-- Shared styles and scripts -->
  <link rel="stylesheet" href="/assets/shared.css" />
  <script src="/assets/shared.js"></script>
</head>
<body>
  
  <header>
    <div class="header-inner">
      <!-- Brand -->
      <div class="brand">
        <div class="logo" aria-hidden="true">LP</div>
        <div>
          <h1 id="appTitle">GPS Transporte ‚Äî La Paz</h1>
          <div style="font-size:12px; opacity:.9">Centro de transporte comunitario</div>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="nav-row">
        <div class="nav-left">
          <div class="menu-item">
            <button class="nav-btn" id="btnRoutes">
              <i class="fa fa-location-dot"></i>
              <span>Rutas</span>
            </button>
            <div class="dropdown">
              <a href="rutas/linea-1.html">L√≠nea 1 ‚Äî Villa F√°tima ‚áÑ Miraflores</a>
              <a href="rutas/linea-2.html">L√≠nea 2 ‚Äî Ceja ‚áÑ Cementerio</a>
              <a href="rutas/linea-3.html">L√≠nea 3 ‚Äî Terminal ‚áÑ Telef√©rico Central</a>
              <a href="ver_rutas.html"><strong>Ver todas las rutas ‚Üí</strong></a>
            </div>
          </div>

          <button class="nav-btn" id="btnGuide">
            <i class="fa fa-book"></i>
            <span>Gu√≠a</span>
          </button>
          
          <button class="nav-btn" id="btnDark">
            <i class="fa fa-moon"></i>
            <span>Modo</span>
          </button>
          
          <button class="nav-btn" id="btnLang">
            <i class="fa fa-language"></i>
            <span>English</span>
          </button>
        </div>

        <div class="nav-right">
          <!-- Admin button (hidden by default) -->
          <div class="menu-item" id="adminSection" style="display:none">
            <button class="nav-btn">
              <i class="fa fa-wrench"></i>
              <span>Admin</span>
            </button>
            <div class="dropdown">
              <a href="agregar_linea.html">‚ûï Agregar l√≠nea</a>
              <a href="base_datos.html">üìÑ Ver base de datos</a>
              <a href="sindicatos.html">ü§ù Sindicatos</a>
            </div>
          </div>

          <div id="userArea">
            <!-- visible when no session -->
            <button class="nav-btn" id="btnRegister">
              <i class="fa fa-user-plus"></i>
              <span>Registrarse</span>
            </button>

            <button class="nav-btn primary" id="btnLogin">
              <i class="fa fa-user"></i>
              <span>Iniciar sesi√≥n</span>
            </button>

            <!-- profile pill (hidden by default) -->
            <div class="menu-item profile-wrap" id="profileWrap" style="display:none;">
              <button class="nav-btn" id="btnProfile">
                <span id="profileAvatar" style="display:inline-grid;place-items:center;width:30px;height:30px;border-radius:50%;background:#fff;color:var(--primary);font-weight:600;margin-right:8px;">A</span>
                <div style="text-align:left;line-height:1;">
                  <div id="profileName" style="font-size:13px;color:#fff;font-weight:600">User</div>
                  <div id="profileEmail" style="font-size:11px;opacity:0.9;color:#eafaf7">email@example.com</div>
                </div>
              </button>
              <div class="dropdown" id="profileDropdown">
                <a href="#" id="btnSwitchUser">Cambiar usuario</a>
                <a href="#" id="btnLogout">Cerrar sesi√≥n</a>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <section>
      <h2 style="margin:0 0 10px 0">Sindicatos</h2>
      <div class="grid" id="gridSindicatos"></div>
    </section>
    <section class="panel">
      <header><h3 style="margin:0" id="selTitle">Selecciona un sindicato</h3></header>
      <div class="content">
        <table class="table" id="tableLines">
          <thead><tr><th style="width:56px">ID</th><th>Ruta</th><th>Veh√≠culo</th><th style="width:120px">Acci√≥n</th></tr></thead>
          <tbody><tr><td colspan="4">No hay l√≠neas seleccionadas.</td></tr></tbody>
        </table>
      </div>
    </section>
  </main>
  <!-- Background map behind content -->
  <div id="bgMap"></div>
  
  <footer>
    <div class="footer-inner">
      <div>Contacto: <a href="mailto:lapazbus@lapaz.bo" style="color:#b2fff5">lapazbus@lapaz.bo</a> ‚Äî Tel: 2652444</div>
      <div style="opacity:.9;font-size:13px">GPS Transporte ‚Äî La Paz</div>
    </div>
  </footer>

  
  <div class="backdrop" id="loginBackdrop" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="modal">
      <header><h3 id="loginTitle" style="margin:0">Iniciar sesi√≥n</h3></header>
      <div class="content">
        <label for="email">Correo</label>
        <input type="email" id="email" placeholder="usuario@gmail.com"/>
        <label for="password">Contrase√±a</label>
        <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
      </div>
      <div class="footer">
        <button class="btn" id="btnCloseLogin">Cerrar</button>
        <button class="btn primary" id="btnDoLogin">Ingresar</button>
      </div>
    </div>
  </div>
  <div class="backdrop" id="guideBackdrop" role="dialog" aria-modal="true" aria-labelledby="guideTitle">
    <div class="modal">
      <header><h3 id="guideTitle" style="margin:0">Gu√≠a r√°pida</h3></header>
      <div class="content"><p>Explora las rutas, administra datos y consulta sindicatos.</p></div>
      <div class="footer"><button class="btn primary" id="btnCloseGuide">Entendido</button></div>
    </div>
  </div>

  <script>
    const $ = s=>document.querySelector(s);

    // Load lineas from server and group by sindicato
    async function renderGrid(){
      const grid = document.getElementById('gridSindicatos'); grid.innerHTML = '<p>Cargando...</p>';
      const lineas = await sharedUI.fetchLineas();
      const grouped = sharedUI.groupBySindicato(lineas);
      grid.innerHTML = '';
      Object.keys(grouped).forEach((s, i) => {
        const items = grouped[s];
        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `<h3>${s}</h3><p>${items.length} l√≠nea(s) registradas</p><p style="font-size:13px;color:#555">Contacto: ‚Äî</p>`;
        card.addEventListener('click', ()=> selectSindicato(s, items)); grid.appendChild(card);
      });
    }

    function selectSindicato(name, lines){
      document.getElementById('selTitle').textContent = name;
      const tbody = document.querySelector('#tableLines tbody');
      if(!tbody) return;
      tbody.innerHTML = '';
      lines.forEach(l=>{
        const tr = document.createElement('tr');
        const stops = Array.isArray(l.paradas) ? l.paradas.length : (l.paradas? l.paradas.join(', '): 0);
        tr.innerHTML = `\n          <td>${l.id||''}</td>\n          <td>${l.nombre||l.ruta||''}</td>\n          <td>${l.vehiculo||''}</td>\n          <td>\n            <div style="display:flex;gap:8px;justify-content:flex-end;">\n              <a class="nav-btn" href="ver_rutas.html#route=${l.codigo||l.id}">Ver ruta</a>\n              <button class="nav-btn btn-outline" onclick="alert('Detalles de ruta: ${l.nombre||l.ruta||''}')">Detalles</button>\n            </div>\n          </td>\n        `;
        tbody.appendChild(tr);
      });
    }

    document.addEventListener('DOMContentLoaded', ()=> renderGrid());
  </script>
  
  <script>
    window.addEventListener('DOMContentLoaded', ()=>{
      const btnDark = document.getElementById('btnDark');
      if(btnDark) btnDark.addEventListener('click', ()=> document.documentElement.classList.toggle('dark'));
      const btnLang = document.getElementById('btnLang');
      if(btnLang){ let lang='es'; btnLang.addEventListener('click', ()=>{ lang=(lang==='es')?'en':'es'; btnLang.textContent=(lang==='es')?'üåê English':'üåê Espa√±ol'; const h1=document.querySelector('h1'); if(h1) h1.textContent=(lang==='es')?'GPS Transporte ‚Äî La Paz':'GPS Transport ‚Äî La Paz'; }); }
      const loginBackdrop = document.getElementById('loginBackdrop');
      const btnLogin = document.getElementById('btnLogin');
      const btnCloseLogin = document.getElementById('btnCloseLogin');
      const btnDoLogin = document.getElementById('btnDoLogin');
      if(btnLogin && loginBackdrop) btnLogin.addEventListener('click', ()=> loginBackdrop.style.display='flex');
      if(btnCloseLogin) btnCloseLogin.addEventListener('click', ()=> loginBackdrop.style.display='none');
      if(btnDoLogin) btnDoLogin.addEventListener('click', ()=>{ loginBackdrop.style.display='none'; /* demo login handled by shared helper */ });
      const guideBackdrop = document.getElementById('guideBackdrop');
      const btnGuide = document.getElementById('btnGuide');
      const btnCloseGuide = document.getElementById('btnCloseGuide');
      if(btnGuide && guideBackdrop) btnGuide.addEventListener('click', ()=> guideBackdrop.style.display='flex');
      if(btnCloseGuide) btnCloseGuide.addEventListener('click', ()=> guideBackdrop.style.display='none');
    });
  </script>

  <!-- Shared session / profile helper (keeps behavior similar to index.html) -->
  <script>
    (function(){
      const USERS_KEY = 'gps_users';
      const CURRENT_USER_KEY = 'gps_current_user';
      const ADMIN_EMAIL = 'admin@admin.com';
      const ADMIN_PASSWORD = 'admin123';

      function getUsers(){ try{ return JSON.parse(localStorage.getItem(USERS_KEY)||'[]'); }catch(e){return[]} }
      function saveUser(user){ const u=getUsers(); u.push(user); localStorage.setItem(USERS_KEY, JSON.stringify(u)); }
      function setCurrent(user){ localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(user)); updateUIForSession(user); }
      function getCurrent(){ try{ return JSON.parse(localStorage.getItem(CURRENT_USER_KEY)||'null'); }catch(e){return null} }

      function ensureProfileWrap(){ let wrap = document.getElementById('profileWrap'); if(!wrap){ const area = document.querySelector('.profile-area'); if(area){ wrap = document.createElement('div'); wrap.id='profileWrap'; area.appendChild(wrap); } } return wrap; }

      function updateUIForSession(session){ const wrap = ensureProfileWrap(); if(!wrap) return; wrap.innerHTML=''; if(!session){ wrap.innerHTML = '<button class="btn primary" id="btnLogin">üîê Iniciar sesi√≥n</button>'; const btnLogin = document.getElementById('btnLogin'); if(btnLogin) btnLogin.addEventListener('click', ()=> document.getElementById('loginBackdrop').style.display='flex'); }
        else { const isAdmin = session.role==='admin'; wrap.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><div style="font-weight:700">${session.name||session.email}</div><div style="font-size:12px;color:#eef">${isAdmin? 'Administrador':'Usuario'}</div><button class="btn" id="btnLogout">Salir</button></div>`; const btnLogout = document.getElementById('btnLogout'); if(btnLogout) btnLogout.addEventListener('click', ()=>{ localStorage.removeItem(CURRENT_USER_KEY); updateUIForSession(null); }); }
      }

      // wire demo login button
      window.addEventListener('DOMContentLoaded', ()=>{
        const btnDoLogin = document.getElementById('btnDoLogin');
        if(btnDoLogin){ btnDoLogin.addEventListener('click', ()=>{
          const email = (document.getElementById('email')||{}).value || 'user@example.com';
          const pass = (document.getElementById('password')||{}).value || '';
          if(email === ADMIN_EMAIL && pass === ADMIN_PASSWORD){ const admin = { name:'Administrador', email:ADMIN_EMAIL, role:'admin'}; setCurrent(admin); alert('Sesi√≥n iniciada: Admin'); }
          else { const user = { name: email.split('@')[0], email, role:'user'}; setCurrent(user); alert('Sesi√≥n iniciada: ' + user.name); }
          document.getElementById('loginBackdrop').style.display='none';
        }); }
        // initialize UI from storage
        updateUIForSession(getCurrent());
      });
    })();
  </script>

</body>
</html>
